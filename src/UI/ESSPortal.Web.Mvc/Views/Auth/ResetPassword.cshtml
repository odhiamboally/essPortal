@model ResetPasswordRequest

@{
    ViewData["Title"] = "Reset Password";
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
}

@section Styles {

    <link href="~/custom/auth/css/reset-password.css" rel="stylesheet" asp-append-version="true" />

}

<div class="signin-card">
    <!-- Brand Header -->
    <div class="brand-header">
        <div class="brand-logo">
            <img src="~/custom/auth/images/unlogo.png" alt="United Nations" class="logo-image" />
        </div>
        <h2 class="brand-title">ESS Portal</h2>
        <p class="brand-subtitle">Empowering Members Financially</p>
    </div>

    <!-- Header -->
    <div class="signin-header">
        <h3 class="signin-title">Create New Password 🔒</h3>
        <p class="signin-subtitle">Your new password must be different from previously used passwords</p>
    </div>

    <!-- Reset Password Form -->
    <form asp-action="ResetPassword" method="post" class="signin-form" novalidate>
        <input type="hidden" asp-for="Email" />
        <input type="hidden" asp-for="Token" />

        <div class="form-group">
            <label class="form-label">Email Address</label>
            <input type="email"
                   class="form-control"
                   value="@Model.Email"
                   readonly
                   style="background-color: #f8f9fa; cursor: not-allowed;" />
        </div>

        <div class="form-group">
            <label asp-for="NewPassword" class="form-label">New Password</label>
            <div class="password-input-wrapper">
                <input asp-for="NewPassword"
                       class="form-control"
                       type="password"
                       placeholder="Enter your new password"
                       autocomplete="new-password" />
                <button type="button" class="password-toggle" id="toggleNewPassword">
                    <span class="eye-icon">👁️</span>
                </button>
            </div>
            <span asp-validation-for="NewPassword" class="field-validation-error"></span>
        </div>

        <div class="form-group">
            <label asp-for="ConfirmPassword" class="form-label">Confirm New Password</label>
            <div class="password-input-wrapper">
                <input asp-for="ConfirmPassword"
                       class="form-control"
                       type="password"
                       placeholder="Confirm your new password"
                       autocomplete="new-password" />
                <button type="button" class="password-toggle" id="toggleConfirmPassword">
                    <span class="eye-icon">👁️</span>
                </button>
            </div>
            <span asp-validation-for="ConfirmPassword" class="field-validation-error"></span>
        </div>

        <!-- Password Requirements -->
        <div class="password-requirements">
            <p class="requirements-title">Password must contain:</p>
            <ul class="requirements-list">
                <li>At least 8 characters</li>
                <li>One uppercase letter (A-Z)</li>
                <li>One lowercase letter (a-z)</li>
                <li>One number (0-9)</li>
                <li>One special character (&#64;&#36;&#33;&#37;&#42;&#63;&#38;)</li>
            </ul>
        </div>

        <button type="submit" class="btn btn-primary btn-signin" id="resetPasswordSubmitBtn">
            Reset Password
        </button>

        <!-- Only show validation summary if there are model-level errors -->
        <div asp-validation-summary="ModelOnly" class="validation-summary"></div>
    </form>


    <!-- Back to Sign In -->
    <div class="back-link">
        <a asp-action="SignIn" class="back-to-signin">
            ← Back to Sign In
        </a>
    </div>
</div>

@section Scripts {

    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Password toggle functionality for both fields
            function setupPasswordToggle(toggleId, inputName) {
                const toggleBtn = document.getElementById(toggleId);
                const passwordInput = document.querySelector(`input[name="${inputName}"]`);
                const eyeIcon = toggleBtn.querySelector('.eye-icon');

                toggleBtn.addEventListener('click', function() {
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        eyeIcon.textContent = '🙈';
                    } else {
                        passwordInput.type = 'password';
                        eyeIcon.textContent = '👁️';
                    }
                });
            }

            setupPasswordToggle('toggleNewPassword', 'NewPassword');
            setupPasswordToggle('toggleConfirmPassword', 'ConfirmPassword');

            // Focus on new password input
            const newPasswordInput = document.querySelector('input[name="NewPassword"]');
            if (newPasswordInput) {
                newPasswordInput.focus();
            }
        });
    </script>

}